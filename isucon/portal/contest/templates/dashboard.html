{% extends "include/layout.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="column is-9">
    <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/">ISUCON9</a></li>
            <li class="is-active"><a href="#" aria-current="page">Dashboard</a></li>
        </ul>
    </nav>

    {% include "include/team_header.html" %}

    {% include "include/job_enqueue.html" %}

    <section class="table-list">
        <div class="card events-card">
            <header class="card-header is-dark">
                <p class="card-header-title">
                    <span class="icon">
                        <i class="fas fa-list-alt"></i>
                    </span>
                    <span>Recent Jobs</span>
                </p>
            </header>
            <div class="card-table">
                <div class="content">
                    <table class="table is-fullwidth is-striped">
                        <thead>
                            <tr>
                                <th>JobId</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th>Result</th>
                                <th>UpdatedAt</th>
                                <th>Detail</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for job in recent_jobs %}
                                <tr {% if not job.is_finished %}class="state-running"{% endif %}>
                                    <td class="has-text-right">{{ job.id }}</td>
                                    <td class="has-text-right">
                                      {% if job.is_finished %}
                                        {{ job.score|intcomma }}
                                      {% endif %}
                                    </td>
                                    <td>
                                      {% if job.status == job.DONE %}
                                        <span class="tag is-success">Done</span>
                                      {% endif %}
                                      {% if job.status == job.ABORTED %}
                                        <span class="tag is-danger">Aborted</span>
                                      {% endif %}
                                      {% if job.status == job.CANCELED %}
                                        <span class="tag is-warning">Canceled</span>
                                      {% endif %}
                                      {% if job.status == job.WAITING %}
                                        <span class="tag is-info">Waiting</span>
                                      {% endif %}
                                      {% if job.status == job.RUNNING %}
                                        <span class="tag is-info">Running</span>
                                      {% endif %}
                                    </td>
                                    <td>
                                      {% if job.is_finished %}
                                        {% if job.is_passed %}
                                          <span class="tag is-success">Passed</span>
                                        {% else %}
                                          <span class="tag is-danger">Failed</span>
                                        {% endif %}
                                      {% endif %}
                                    </td>
                                    <td>{{ job.updated_at|date:"H:i:s" }}</td>
                                    <td><a class="button is-small is-link" href="{% url "job_detail" job.id %}">show</a></td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <footer class="card-footer">
                <a href="{% url "jobs" %}" class="card-footer-item">View All</a>
            </footer>
        </div>
    </section>

    <section class="table-list">
        <div class="card events-card">
            <header class="card-header is-danger">
                <p class="card-header-title">
                    <span class="icon">
                        <i class="fas fa-chart-area"></i>
                    </span>
                    <span>Top Teams</span>
                </p>
            </header>
            {% if is_last_spurt %}
                <article class="message is-danger">
                    <div class="message-body">
                        <strong class="buruburu">残り1時間切ったのでみせられませぬぞ〜</strong>
                    </div>
                </article>
            {% else %}
            <div class="card-table">
                <div class="content">
                    <table class="table is-fullwidth is-striped">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Id</th>
                                <th>Name</th>
                                <th>LatestScore</th>
                                <th>BestScore</th>
                                <th>FinishTime</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for score in top_teams %}
                            <tr {% if team.id == user.team.id %}class="is-selected"{% endif %}>
                                <td class="has-text-right">{{ forloop.counter }}</td>
                                <td class="has-text-right">{{ score.team.id }}</td>
                                <td>{{ score.team }}</td>
                                <td class="has-text-right">{{ score.latest_score|intcomma }}</td>
                                <td class="has-text-right">{{ score.best_score|intcomma }}</td>
                                <td>{{ score.latest_scored_at|date:"H:i:s" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <footer class="card-footer">
                <a href="{% url "scores" %}" class="card-footer-item">View All</a>
            </footer>
        </div>
        {% endif %}
    </section>

    <section class="graph">
        <canvas id="myChart" width="400" height="200"></canvas>
    </section>
</div>
<!-- dummy -->
<form method="post"></form>

{% block script %}
{% comment %}
<script src="{% static "js/graph.js" %}"></script>
{% endcomment %}

<script>
(function() {
    var labelColors = [
        [244,67,54],
        [233,30,99],
        [156,39,176],
        [103,58,183],
        [63,81,181],
        [33,150,243],
        [3,169,244],
        [0,188,212],
        [0,150,136],
        [76,175,80],
        [139,195,74],
        [205,220,57],
        [255,235,59],
        [255,193,7],
        [255,152,0],
        [255,87,34],
        [121,85,72],
        [158,158,158],
        [96,125,139],

        [239,83,80],
        [236,64,122],
        [171,71,188],
        [126,87,194],
        [92,107,192],
        [66,165,245],
        [41,182,246],
        [38,198,218],
        [38,166,154],
        [102,187,106],
        [156,204,101],
        [212,225,87],
        [255,238,88],
        [255,202,40],
        [255,167,38],
        [255,112,67],
        [141,110,99],
        [189,189,189],
        [120,144,156],

        [229,115,115],
        [240,98,146],
        [186,104,200],
        [149,117,205],
        [121,134,203],
        [100,181,246],
        [79,195,247],
        [77,208,225],
        [77,182,172],
        [129,199,132],
        [174,213,129],
        [220,231,117],
        [255,241,118],
        [255,213,79],
        [255,183,77],
        [255,138,101],
        [161,136,127],
        [224,224,224],
        [144,164,174],
    ];

    var ctx = $("#myChart");
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            // labels: JSON.parse('<: $chart_data.labels | json :>'),
            labels: {{ graph_data.labels | safe }},
            datasets: [
                {% for dataset in graph_data.datasets %}
                {
                    label: "{{ dataset.label }}",
                    data: {{ dataset.data | safe }},
                    lineTension: 0,
                    backgroundColor: 'rgba(' + labelColors[ {{ forloop.counter0 }} % (labelColors.length - 1) ].join(',')  + ',1)',
                    borderColor: "rgba(" + labelColors[ {{ forloop.counter0 }} % (labelColors.length - 1) ].join(',')  + ',1)',
                    borderWidth: 2,
                    fill: false,
                    pointHoverRadius: 4,
                    pointRadius: 2,
                    spanGaps: true,
                },
                {% endfor %}
            ],
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }]
            }
        }
    });
})()
</script>

{% endblock script %}


{% endblock content %}



